<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHOP</title>
    <link rel="stylesheet" href="./css/shopmoletons.css">
</head>

<body>

    <h1 id="tituloH1"><a href="./index.html">STREETWEAR</a></h1>

    <div id="menu">
        <h1 id="camisetas"><a href="./shop.html">CAMISETAS</a></h1>
        <h1 id="calças"><a href="./shopcalças.html">CALÇAS</a></h1>
        <h1 id="moletons"><a href="shopmoletons.html">MOLETONS</a></h1>
        <h1 id="tênis"><a href="shopjacketa.html">JAQUETAS</a></h1>
    </div>
    </div>

    <div id="principal">

        <div id="camiseta1">
            <img src="./assets/balenciaga cats.jpg">
            <p>BALENCIAGA I LOVE CATS</p>
            <p id="p1">R$5.000,00</p>
            <button onclick="cadastrar('BALENCIAGA I LOVE CATS',5000.0)" class="botaoCadastrar">adicionar no
                carrinho</button>
        </div>

        <div id="camiseta2">
            <img src="./assets/vetements metal.jpg">
            <p>VETEMENTS HEAVY METAL</p>
            <p id="p2">R$4.500,00</p>
            <button onclick="cadastrar('VETEMENTS HEAVY METAL',4500.0)" class="botaoCadastrar">adicionar no
                carrinho</button>
        </div>

        <div id="camiseta3">
            <img src="https://th.bing.com/th/id/R.d3f1458dd6b0acccf6ac85f15081a9b0?rik=OI6ZtnU70wntGg&pid=ImgRaw&r=0">
            <p>TRAVIS SCOTT X AIR JORDAN</p>
            <p id="p3">R$1.500,00</p>
            <button onclick="cadastrar('TRAVIS SCOTT X AIR JORDAN',1500.0)" class="botaoCadastrar">adicionar no
                carrinho</button>
        </div>

        <div id="camiseta4">
            <img src="./assets/stussy basic.jpg">
            <p>STUSSY BASIC BLACK</p>
            <p id="p4">R$1000,00</p>
            <button onclick="cadastrar('STUSSY BACIC BLACK',1000.0)" class="botaoCadastrar">adicionar no
                carrinho</button>
        </div>
    </div>

    <div id="principal2">

        <div id="camiseta5">
            <img src="./assets/FA VERDE.webp">
            <p>FUCKING AWESOME CUT OUT</p>
            <p id="p5">R$700,00</p>
            <button onclick="cadastrar('FUCKING AWESOME CUT OUT',700.0)" class="botaoCadastrar">adicionar no
                carrinho</button>
        </div>

        <div id="camiseta6">
            <img src="./assets/FA BRANCO.webp">
            <p>FUCKING AWESOME QUANTUM</p>
            <p id="p6">R$850,00</p>
            <button onclick="cadastrar('FUCKING AWESOME QUANTUM',850.0)" class="botaoCadastrar">adicionar no
                carrinho</button>
        </div>

        <div id="camiseta7">
            <img src="assets/fa murder.webp">
            <p>FUCKING AWESOME JACKYLL</p>
            <p id="p7">R$700,00</p>
            <button onclick="cadastrar('FUCKING AWESOME JACKYLL',700.0)" class="botaoCadastrar">adicionar no
                carrinho</button>
        </div>

        <div id="camiseta8">
            <img src="./assets/FA GRAPIHC.webp">
            <p>FUCKING AWESOME WHAT'S NEXT</p>
            <p id="p8">R$699,00,00</p>
            <button onclick="cadastrar('FUCKING AWESOME WHATS NEXT',699.0)" class="botaoCadastrar">adicionar no
                carrinho</button>
        </div>
    </div>

    <div id="principal3">

        <div id="camiseta9">
            <img src="./assets/palace blue.webp">
            <p>PALACE SNAKE</p>
            <p id="p9">R$1200,00</p>
            <button onclick="cadastrar('PALACE SNAKE',1200.0)" class="botaoCadastrar">adicionar no carrinho</button>
        </div>

        <div id="camiseta10">
            <img src="./assets/PALACE BLUE 2.webp">
            <p>PALACE CRYSTALIZED</p>
            <p id="p10">R$900,00</p>
            <button onclick="cadastrar('PALACE CRYSTALIZED',900.0)" class="botaoCadastrar">adicionar no
                carrinho</button>
        </div>

        <div id="camiseta11">
            <img src="./assets/supreme box.webp">
            <p>SUPREME BOX LOGO</p>
            <p id="p11">R$3.500,00</p>
            <button onclick="cadastrar('SUPREME BOX LOGO',3500.0)" class="botaoCadastrar">adicionar no
                carrinho</button>
        </div>

        <div id="camiseta12">
            <img src="./assets/high space g.jpg">
            <p>HIGH SPACE G</p>
            <p id="p12">R$420,00</p>
            <button onclick="cadastrar('HIGH SPACE G',420.0)" class="botaoCadastrar">adicionar no carrinho</button>
        </div>
    </div>

    <div id="linha"></div>

    <div id="carrinho">
        <h1 id="checkout">CHECKOUT</h1>
        <img src="./assets/carrinho.png" id="imgcarrinho">
        <p id="peçasFinais">SEUS ITENS:<span id="itensCarrinho"></span></p>
        <p id="preçoFinal">VALOR TOTAL R$:<span id="precoCarrinho"></span></p>
        <button onclick="cadastrarBanco()" id="botaoFinalizar">FINALIZAR COMPRA</button>
    </div>

    <div class="rodapé">
        <h4> copyright by anthony.ferreira@sptech.school &copy; </h4>
</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.all.min.js"></script>

<script>

    var listaProduto = []
    var listaPreco = []
    var idUsuario = sessionStorage.getItem("ID_USUARIO")

    if (sessionStorage.getItem("listaProduto") != "") {
        listaProduto = sessionStorage.getItem("listaProduto").split(",");
    }

    if (sessionStorage.getItem("listaPreco") != "") {
        listaPreco = sessionStorage.getItem("listaPreco").split(",").map((preco) => Number(preco))
    }

    adicionarAoCarrinho();

    function cadastrar(produto, preco) {

        Swal.fire({
            icon: 'success',
            title: 'ITEM ADICIONADO AO CARRINHO',
            text: 'Continue Navegando',
        })

        itensCarrinho.innerHTML = ``
        precoCarrinho.innerHTML = ``
        console.log(`produto: ${produto} - preço: ${preco}`)

        listaPreco.push(preco)
        listaProduto.push(produto)


        adicionarAoCarrinho()


        sessionStorage.setItem('listaProduto', listaProduto);
        sessionStorage.setItem('listaPreco', listaPreco);

    }

    function adicionarAoCarrinho() {
        var somaPreco = 0
        for (contador = 0; contador < listaPreco.length; contador++) {

            somaPreco += listaPreco[contador]

            itensCarrinho.innerHTML += listaProduto[contador] + " | "
            precoCarrinho.innerHTML = somaPreco

            console.log("Somar: " + somaPreco)
            console.log(`produto lista: ${listaProduto[0]} - preço lista: ${listaPreco[0]}`)
        }
    }

    function cadastrarBanco() {

        var somaProduto = 0
        var somaPreco = 0

        if (listaPreco == "" || listaProduto == "") {
            Swal.fire('CARRINHO VAZIO')
        } else {
            Swal.fire('COMPRA REALIZADA COM SUCESSO ENVIAREMOS UM EMAIL COM MAIS INFORMAÇÕES')
            console.log(listaProduto, listaPreco)

            for (contador = 0; contador < listaPreco.length; contador++) {
                somaPreco += listaPreco[contador]
            }
            console.log(somaPreco)

            for (contador = 0; contador < listaProduto.length; contador++) {
                somaProduto += listaProduto[contador]
            }
            console.log(somaProduto)

            fetch("/carrinho/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    produtosServer:  listaProduto,
                    precoTotalServer: somaPreco,
                    fkUsuarioServer: idUsuario
                })
            }).then(function (resposta) {
                console.log("ESTOU NO THEN DO entrar()!")

                if (resposta.ok) {
                    console.log(resposta);

                    resposta.json().then(json => {
                        console.log(json);
                        console.log(JSON.stringify(json));

                        sessionStorage.EMAIL_USUARIO = json.email;
                        sessionStorage.NOME_USUARIO = json.nome;
                        sessionStorage.ID_USUARIO = json.id;

                        setTimeout(function () {
                            //  Swal.fire('LOGIN REALIZADO COM SUCESSO BEM VINDO')
                            // window.location = "shop.html"
                            setTimeout(() => {
                                // window.location = "shop.html";
                            }, "3000")

                        }, 500); // apenas para exibir o loading

                    });

                } else {

                    Swal.fire('USUARIO NÃO CADASTRADO REDIRECIONANDO...')
                    setTimeout(() => {
                    window.location = "login.html";
                }, "2000")
                    console.log("Houve um erro ao tentar realizar o login!");

                    resposta.text().then(texto => {
                        console.error(texto);
                        finalizarAguardar(texto);
                    });
                }

            }).catch(function (erro) {
                console.log(erro);
            })
            itensCarrinho.innerHTML = ""
            precoCarrinho.innerHTML = ""

            listaProduto = []
            listaPreco = []
            sessionStorage.setItem('listaPreco', "");
            sessionStorage.setItem('listaProduto', "");
        }
    }
</script>