<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHOP</title>
    <link rel="stylesheet" href="./css/shop.css">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.min.css "rel="folha de estilo">
</head>

<body>

    <h1 id="tituloH1"><a href="./index.html">STREETWEAR</a></h1>
    
    <div id="menu">
        <h1 id="camisetas"><a href="./shop.html">CAMISETAS</a></h1>
        <h1 id="calças"><a href="./shopcalças.html">CALÇAS</a></h1>
        <h1 id="moletons"><a href="shopmoletons.html">MOLETONS</a></h1>
        <h1 id="tênis"><a href="shopjacketa.html">JAQUETAS</a></h1>
    </div>
    </div>

    <div id="principal">

            <div id="camiseta1">
                <img src="./assets/4suf.webp">
                <p>SUFGANG 4SUF</p>
                <p id="p1">R$220,00</p>
                <button onclick="cadastrar('SUFGANG 4SUF, ',220.0)" class="botaoCadastrar">adicionar no carrinho</button>
            </div>

            <div id="camiseta2">
                <img src="./assets/basic suf.webp">
                <p>SUFGANG BASIC BLACK</p>
                <p id="p2">R$140,00</p>
                <button onclick="cadastrar('SUFGANG BASIC BLACK, ',140.0)" class="botaoCadastrar">adicionar no carrinho</button>
            </div>

            <div id="camiseta3">
                <img src="./assets/sufgang arabic.webp">
                <p>SUFGANG CODE ARABIC</p>
                <p id="p3">R$250,00</p>
                <button onclick="cadastrar('SUFGANG CODE ARABIC, ',250.0)" class="botaoCadastrar">adicionar no carrinho</button>
            </div>

            <div id="camiseta4">
                <img src="./assets/utopia suf.webp">
                <p>SUFGANG UTOPIA</p>
                <p id="p4">R$320,00</p>
                <button onclick="cadastrar('SUFGANG, ',320.0)" class="botaoCadastrar">adicionar no carrinho</button>
            </div>
        </div>

        <div id="principal2">

            <div id="camiseta5">
                <img src="assets/high listrada v3.webp">
                <p>HIGH KIDZ</p>
                <p id="p5">R$260,00</p>
                <button onclick="cadastrar('HIGH KIDZ, ',260.0)" class="botaoCadastrar">adicionar no carrinho</button>
            </div>

            <div id="camiseta6">
                <img src="assets/high do the sims.jpg">
                <p>HIGH SINNER</p>
                <p id="p6">R$180,00</p>
                <button onclick="cadastrar('HIGH SINNER, ',180.0)" class="botaoCadastrar">adicionar no carrinho</button>
            </div>

            <div id="camiseta7">
                <img src="assets/high baby brown.jpg">
                <p>HIGH BABY BROWN</p>
                <p id="p7">R$220,00</p>
                <button onclick="cadastrar('HIGH BABY BROWN, ',220.0)" class="botaoCadastrar">adicionar no carrinho</button>
            </div>

            <div id="camiseta8">
                <img src="assets/high years.jpg">
                <p>HIGH YEARS</p>
                <p id="p8">R$300,00</p>
                <button onclick="cadastrar('HIGH YEARS, ',300.0)" class="botaoCadastrar">adicionar no carrinho</button>
            </div>
        </div>

        <div id="principal3">

            <div id="camiseta9">
                <img src="./assets/class basic.webp">
                <p>CLASS INVERSE LOGO</p>
                <p id="p9">R$180,00</p>
                <button onclick="cadastrar('CLASS INVERSE LOGO, ',180.0)" class="botaoCadastrar">adicionar no carrinho</button>
            </div>

            <div id="camiseta10">
                <img src="assets/class disco.webp">
                <p>CLASS MEDIA PLAYER</p>
                <p id="p10">R$230,00</p>
                <button onclick="cadastrar('CLASS MEDIA PLAYER, ',230.0)" class="botaoCadastrar">adicionar no carrinho</button>
            </div>

            <div id="camiseta11">
                <img src="assets/class muie.webp">
                <p>CLASS BACKS</p>
                <p id="p11">R$170,00</p>
                <button onclick="cadastrar('CLASS BACKS, ',170.0)" class="botaoCadastrar">adicionar no carrinho</button>
            </div>

            <div id="camiseta12">
                <img src="assets/csioandreasi-class-still-d1-2023-44.webp">
                <p id="nomep12">CLASS PIPA</p>
                <p id="p12">R$200,00</p>
                <button onclick="cadastrar('CLASS PIPA, ',200.0)" class="botaoCadastrar">adicionar no carrinho</button>
            </div>
        </div>

        <div id="linha"></div>

        <div id="carrinho">
            <h1 id="checkout">CHECKOUT</h1>
            <img src="./assets/carrinho.png" id="imgcarrinho">
            <p id="peçasFinais">SEUS ITENS: <span id="itensCarrinho"></span></p>
            <p id="preçoFinal">VALOR TOTAL R$: <span id="precoCarrinho"></span></p>
            <button onclick="cadastrarBanco()" id="botaoFinalizar">FINALIZAR COMPRA</button>
        </div>

        <div class="rodapé">
            <h4> copyright by anthony.ferreira@sptech.school &copy; </h4>
</body>
</html>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.all.min.js"></script>

<script>

    var idUsuario = sessionStorage.getItem("ID_USUARIO")
    console.log (idUsuario)
    var listaProduto = []
    var listaPreco = []

    function cadastrar (produto, preco) {
        
        Swal.fire({
        icon: 'success',
        title: 'ITEM ADICIONADO AO CARRINHO',
        text: 'Continue Navegando',
        })

        itensCarrinho.innerHTML = ``
        precoCarrinho.innerHTML = ``
        
        listaPreco.push(preco)
        listaProduto.push(produto)
        
        var somaPreco = 0
        for (contador = 0; contador < listaPreco.length; contador ++) {
            
        somaPreco += listaPreco[contador]

        itensCarrinho.innerHTML += listaProduto[contador]
        precoCarrinho.innerHTML = somaPreco
    }
    
            // Para armazenar os valores
            var listaPrecoFinal = localStorage.getItem("listaProduto")
        console.log (listaPrecoFinal)
        sessionStorage.setItem('listaProduto', JSON.stringify(listaProduto));
        sessionStorage.setItem('listaPreco', JSON.stringify(listaPreco));
    
    }

    function cadastrarBanco () {

        // Para armazenar os valores
        var listaPrecoFinal = localStorage.getItem("listaProduto")
        console.log (listaPrecoFinal)
        localStorage.setItem('listaProduto', JSON.stringify(listaProduto));
        localStorage.setItem('listaPreco', JSON.stringify(listaPreco));

        // Para recuperar os valores
        var listaProdutoSalva = JSON.parse(localStorage.getItem('listaProduto'));
        var listaPrecoSalva = JSON.parse(localStorage.getItem('listaPreco'));

        var resultadoElement = document.getElementById("resultado");

        // Convertendo as arrays em strings
        var listaProdutoString = listaProduto.join(", "); // Converter a array em uma string separada por vírgulas
        var listaPrecoString = listaPreco.join(", "); // Converter a array em uma string separada por vírgulas

        var somaProduto = 0
        var somaPreco = 0

        if (listaPreco == "" || listaProduto == "") {
            Swal.fire('CARRINHO VAZIO')    
        } else {
        Swal.fire('COMPRA REALIZADA COM SUCESSO ENVIAREMOS UM EMAIL COM MAIS INFORMAÇÕES')
        console.log (listaProduto, listaPreco)

        for (contador = 0; contador < listaPreco.length; contador ++) {
            somaPreco += listaPreco[contador]
        }
        console.log (somaPreco)

        for (contador = 0; contador < listaProduto.length; contador ++) {
            somaProduto += listaProduto[contador]
        }
        console.log (somaProduto)

        fetch("/carrinho/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                produtosServer: somaProduto,
                precoTotalServer: somaPreco,
                fkUsuarioServer:  idUsuario
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.id;

                    setTimeout(function () {
                    //  Swal.fire('LOGIN REALIZADO COM SUCESSO BEM VINDO')
                        // window.location = "shop.html"
                        setTimeout(() => {
                    // window.location = "shop.html";
                }, "3000")

                    }, 500); // apenas para exibir o loading

                });

            } else {

                Swal.fire('USUARIO NÃO CADASTRADO')
                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })    
    }   
    }
</script>